#include <iostream>
#include <iomanip>
#include "sqlite3.h"
#include <string>
#include <windows.h>

using namespace std;

struct Student {
    int studentCode;
    string name;
    int day[7];
    int totalHours;
    double averageHours;
};

sqlite3* db;
sqlite3_stmt* stmt;

const char* DB_NAME = "student_academic_tracker.db";

int executeSQL(const string& sql) {
    char* errMsg = nullptr;
    int rc = sqlite3_exec(db, sql.c_str(), nullptr, nullptr, &errMsg);
    if (rc != SQLITE_OK) {
        cerr << "SQL Error: " << errMsg << endl;
        sqlite3_free(errMsg);
    }
    return rc;
}

void initializeDatabase() {
    int rc = sqlite3_open(DB_NAME, &db);
    if (rc) {
        cerr << "Can't open database: " << sqlite3_errmsg(db) << endl;
        exit(0);
    }

    string createTableSQL = R"(
        CREATE TABLE IF NOT EXISTS students (
            studentCode INTEGER PRIMARY KEY,
            name TEXT,
            day1 INTEGER,
            day2 INTEGER,
            day3 INTEGER,
            day4 INTEGER,
            day5 INTEGER,
            day6 INTEGER,
            day7 INTEGER,
            totalHours INTEGER,
            averageHours REAL
        );
    )";

    executeSQL(createTableSQL);
}
void addStudent() {
    system("cls");
    Student s;
    s.totalHours = 0;

    cout << "Enter student name: ";
    cin >> s.name;
    cout << "Enter student code: ";
    cin >> s.studentCode;

    for (int i = 0; i < 7; ++i) {
        int hours;
        do {
            cout << "Enter study hours for day " << i + 1 << " (<=24): ";
            cin >> hours;
        } while (hours < 0 || hours > 24);
        s.day[i] = hours;
        s.totalHours += hours;
    }

    s.averageHours = static_cast<double>(s.totalHours) / 7.0;

    string insertSQL = "INSERT INTO students (studentCode, name, day1, day2, day3, day4, day5, day6, day7, totalHours, averageHours) VALUES (" +
        to_string(s.studentCode) + ", '" + s.name + "', " +
        to_string(s.day[0]) + ", " + to_string(s.day[1]) + ", " +
        to_string(s.day[2]) + ", " + to_string(s.day[3]) + ", " +
        to_string(s.day[4]) + ", " + to_string(s.day[5]) + ", " +
        to_string(s.day[6]) + ", " + to_string(s.totalHours) + ", " +
        to_string(s.averageHours) + ");";

    executeSQL(insertSQL);
    cout << "Student added successfully!" << endl;
}
